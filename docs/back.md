# 仕様書（バックエンド）
## 概要
- 入力されたお題(theme)からワードウルフ用の単語ペアを作成する。
- AIはサーバー側のみ使用
- フロントエンドからはAPIを呼び出すだけで利用できる
- AIには1回のリクエストで10組の単語ペアを生成させる。
- レスポンスとして返されるのは10組のうち1組のみ
## エンドポイント
    POST /api/generate-word
- 内部的に10組の単語ペアを保存するが、フロントエンドには常に一組だけ返却する
## 入力
    {
    "theme": "string（必須、1〜20文字）"
    }
## 入力制約
- themeが存在しない、または空文字の場合は失敗
- 20文字以上の場合は失敗
- 日本語を想定
## 入力時エラー
    - 失敗時はAIを呼び出さずフォールバックを使用
## 入力時エラーの扱い
- 入力エラー時はフォールバックを使用する
- レスポンス形式は成功時と同一とする
## 出力（成功）
    {
    "citizenWord": "string",
    "wolfWord": "string"
    }
## 出力制約
- 両方とも名詞
- citizenWordとwolfWordは明確に異なる必要がある
- 入力されたジャンルに沿ったワードにする
- 日本語
## 禁止事項 
- 同一単語や似た意味の単語
- 上位下位概念（例：犬、動物）
- 日本語以外の言語
- 説明文・補足分を含めないこと
## プロンプト（固定）
    あなたはワードウルフ用の単語生成AIです。
    以下の条件を厳守してください。

    ・テーマに沿った名詞の単語ペアを10組生成する
    ・各ペアはcitizenWordとwolfWordの二つの単語を持つ
    ・citizenWordは市民用、wolfWordはウルフ用
    ・同一ジャンルだが明確に異なる単語
    ・同じ単語ペアを複数生成しない
    ・日本語のみ
    ・出力はJSONのみ

    出力形式：
    {
        "words": [
            {
            "citizenWord": "string",
            "wolfWord": "string"
            }
        ]
    }
    テーマ：{theme}
## キャッシュ仕様
- 生成された10組の単語ペアをバックエンド側で保持する
- 単語ペアをサーバーのメモリ上に配列として保存する
- キャッシュに単語が存在する場合はAI,APIは呼び出さない
- APIリクエスト時は10組の中からランダムに1組を取得しレスポンスとして返す
- 返却した単語は配列から削除する
- キャッシュがなくなったら再度AI,API呼び出しを可能とする
- キャッシュは永続化せずリロード時などにはキャッシュが消えてもい
- フロントエンドへ複数の単語ペアを返却することは禁止する
- キャッシュはtheme単位で管理する
- 同時に保持できるキャッシュは1テーマ分のみ
## 失敗時使用
- 以下の場合は生成が失敗したと判断する
    - jsonで出力されていないとき
    - citizenWordとwolfWordの片方しか出力されていない
    - citizenWordとwolfWordが同一単語
    - AI,APIのタイムアウト,エラー
## 失敗時の対応
    - 事前定義ワードペア配列からランダムに1組を返す
    -フォールバック時もレスポンス形式は成功時と同様
## フォールバックワード
    - 事前定義ワードは10組
    - themeと一致しなくてもよい
    - 日本語、名詞とする
## レスポンス
    - 成功時：HTTP 200
    - フォールバック使用時もHTTP 200とする
    - エラー情報はレスポンスに含まない
## AI利用仕様
    - AI APIキーは環境変数から取得する
    - サーバーコード内に直接記述しない
    - タイムアウトやAPIエラー時は失敗扱いとする


    


